sql {
    # Tipo de banco de dados
    driver = "rlm_sql_postgresql"
    dialect = "postgresql"
    
    # Informações de conexão
    server = "postgres"
    port = 5432
    login = "${POSTGRES_USER}"
    password = "${POSTGRES_PASSWORD}"
    
    # Nome do banco de dados
    radius_db = "${POSTGRES_DB}"
    
    # Se você quiser ler os clientes da tabela 'nas' (opcional)
    read_clients = no
    
    # Tabelas do banco de dados
    client_table = "nas"
    
    # Pool de conexões
    pool {
        start = 5
        min = 3
        max = 32
        spare = 10
        uses = 0
        retry_delay = 30
        lifetime = 0
        idle_timeout = 60
        connect_timeout = 3.0
    }
    
    # Queries SQL personalizadas
    authorize_check_query = "SELECT id, username, attribute, value, op \
        FROM ${authcheck_table} \
        WHERE username = '%{SQL-User-Name}' \
        ORDER BY id"
    
    authorize_reply_query = "SELECT id, username, attribute, value, op \
        FROM ${authreply_table} \
        WHERE username = '%{SQL-User-Name}' \
        ORDER BY id"
    
    authorize_group_check_query = "SELECT id, groupname, attribute, \
        Value, op \
        FROM ${groupcheck_table} \
        WHERE groupname = '%{${group_attribute}}' \
        ORDER BY id"
    
    authorize_group_reply_query = "SELECT id, groupname, attribute, \
        value, op \
        FROM ${groupreply_table} \
        WHERE groupname = '%{${group_attribute}}' \
        ORDER BY id"
    
    group_membership_query = "SELECT groupname \
        FROM ${usergroup_table} \
        WHERE username = '%{SQL-User-Name}' \
        ORDER BY priority"
    
    # Queries de accounting
    accounting_start_query = "INSERT INTO ${acct_table1} \
        (acctsessionid, acctuniqueid, username, realm, nasipaddress, \
        nasportid, nasporttype, acctstarttime, acctupdatetime, \
        acctstoptime, acctsessiontime, acctauthentic, connectinfo_start, \
        connectinfo_stop, acctinputoctets, acctoutputoctets, \
        calledstationid, callingstationid, acctterminatecause, \
        servicetype, framedprotocol, framedipaddress) \
        VALUES \
        ('%{Acct-Session-Id}', '%{Acct-Unique-Session-Id}', \
        '%{SQL-User-Name}', '%{Realm}', '%{NAS-IP-Address}', \
        '%{%{NAS-Port-ID}:-%{NAS-Port}}', '%{NAS-Port-Type}', \
        TO_TIMESTAMP(%{integer:Event-Timestamp}), \
        TO_TIMESTAMP(%{integer:Event-Timestamp}), \
        NULL, 0, '%{Acct-Authentic}', '%{Connect-Info}', \
        NULL, 0, 0, '%{Called-Station-Id}', \
        '%{Calling-Station-Id}', NULL, '%{Service-Type}', \
        '%{Framed-Protocol}', \
        NULLIF('%{Framed-IP-Address}', '')::inet)"
    
    accounting_update_query = "UPDATE ${acct_table1} \
        SET acctupdatetime = TO_TIMESTAMP(%{integer:Event-Timestamp}), \
        acctsessiontime = %{%{Acct-Session-Time}:-0}, \
        acctinputoctets = %{%{Acct-Input-Gigawords}:-0}::bigint << 32 | \
        %{%{Acct-Input-Octets}:-0}::bigint, \
        acctoutputoctets = %{%{Acct-Output-Gigawords}:-0}::bigint << 32 | \
        %{%{Acct-Output-Octets}:-0}::bigint \
        WHERE acctsessionid = '%{Acct-Session-Id}' \
        AND username = '%{SQL-User-Name}' \
        AND nasipaddress = '%{NAS-IP-Address}'"
    
    accounting_stop_query = "UPDATE ${acct_table1} \
        SET acctstoptime = TO_TIMESTAMP(%{integer:Event-Timestamp}), \
        acctsessiontime = %{%{Acct-Session-Time}:-0}, \
        acctinputoctets = %{%{Acct-Input-Gigawords}:-0}::bigint << 32 | \
        %{%{Acct-Input-Octets}:-0}::bigint, \
        acctoutputoctets = %{%{Acct-Output-Gigawords}:-0}::bigint << 32 | \
        %{%{Acct-Output-Octets}:-0}::bigint, \
        acctterminatecause = '%{Acct-Terminate-Cause}', \
        connectinfo_stop = '%{Connect-Info}' \
        WHERE acctsessionid = '%{Acct-Session-Id}' \
        AND username = '%{SQL-User-Name}' \
        AND nasipaddress = '%{NAS-IP-Address}'"
    
    # Query para registrar tentativas de autenticação
    post-auth {
        query = "INSERT INTO ${postauth_table} \
            (username, pass, reply, authdate, nasipaddress, nasportid, packettype) \
            VALUES \
            ('%{User-Name}', '%{%{User-Password}:-Chap-Password}', \
            '%{reply:Packet-Type}', NOW(), '%{NAS-IP-Address}', \
            '%{%{NAS-Port-ID}:-%{NAS-Port}}', '%{Packet-Type}')"
    }
    
    # Nomes das tabelas
    authcheck_table = "radcheck"
    authreply_table = "radreply"
    groupcheck_table = "radgroupcheck"
    groupreply_table = "radgroupreply"
    usergroup_table = "radusergroup"
    acct_table1 = "radacct"
    acct_table2 = "radacct"
    postauth_table = "radpostauth"
    
    # Atributo de grupo
    group_attribute = "SQL-Group"
    
    # Configurações adicionais
    $INCLUDE ${modconfdir}/sql/main/${dialect}/queries.conf
}
